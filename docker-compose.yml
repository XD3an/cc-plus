version: '3.8'

services:
  claude-code:
    build:
      context: .
      dockerfile: Dockerfile
    container_name: claude-code

    # Keep container running
    stdin_open: true
    tty: true

    # Mount local directories to container
    volumes:
      # Persist Claude Code configuration
      - claude-config:/home/claude/.config/claude
      # Persist bash history
      - claude-bash-history:/home/claude/.bash_history

    # Environment variables
    environment:
      - ANTHROPIC_API_KEY=${ANTHROPIC_API_KEY:-}
      # Other potentially needed environment variables
      - TERM=xterm-256color

    # Network mode
    network_mode: bridge

    # Restart policy
    restart: unless-stopped

    # Resource limits (optional, adjust as needed)
    deploy:
      resources:
        limits:
          cpus: '4'
          memory: 8G
        reservations:
          cpus: '2'
          memory: 4G

# Define persistent volumes
volumes:
  claude-config:
    driver: local
  claude-bash-history:
    driver: local
